<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 30px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #4CAF50, #45a049);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .room-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .room-card:hover {
            transform: translateY(-5px);
            border-color: #4CAF50;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.2);
        }

        .room-card.active {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.05);
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .room-number {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .room-stats {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #aaa;
        }

        .room-stats span {
            background: rgba(255, 255, 255, 0.1);
            padding: 3px 8px;
            border-radius: 10px;
        }

        .room-title {
            font-size: 18px;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .room-url {
            font-size: 12px;
            color: #888;
            margin-bottom: 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .questions-list {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 15px;
        }

        .question-item {
            background: rgba(255, 255, 255, 0.03);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 3px solid #2196F3;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .question-number {
            font-weight: bold;
            color: #2196F3;
        }

        .answer-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #fff;
            font-size: 14px;
            margin-top: 5px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .room-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #888;
            font-size: 18px;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .connection-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 12px;
            color: #aaa;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        .questions-list::-webkit-scrollbar {
            width: 6px;
        }

        .questions-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .questions-list::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 3px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .rooms-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .connection-info {
                position: static;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <h1>üìö –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Ç–µ—Å—Ç–æ–≤</h1>
            </div>
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="connection-status">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
            </div>
        </div>

        <div class="rooms-grid" id="rooms-container">
            <!-- –ö–æ–º–Ω–∞—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            <div class="empty-state" id="empty-state">
                <div>üì≠</div>
                <div>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç</div>
                <div style="font-size: 14px; margin-top: 10px;">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div>
            </div>
        </div>

        <div class="connection-info" id="connection-info">
            ID: <span id="admin-id">–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span> | 
            –ö–æ–º–Ω–∞—Ç: <span id="rooms-count">0</span>
        </div>
    </div>

    <script>
        (async () => {
            'use strict';
            
            const production = location.protocol === 'https:' ? 
                'wss://young-z7wb.onrender.com' : 
                'ws://localhost:10000';
            
            let socket = null;
            let adminId = null;
            let rooms = new Map(); // roomId -> { roomData, tests }
            let isConnected = false;
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID –∞–¥–º–∏–Ω–∞
            function generateAdminId() {
                const savedId = localStorage.getItem('adminId');
                if (savedId) return savedId;
                
                const newId = `admin-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                localStorage.setItem('adminId', newId);
                return newId;
            }
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ WebSocket
            function connectWebSocket() {
                if (socket && socket.readyState === WebSocket.OPEN) return;
                
                updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É...', 'warning');
                
                socket = new WebSocket(production);
                
                socket.onopen = () => {
                    isConnected = true;
                    adminId = generateAdminId();
                    
                    socket.send(JSON.stringify({
                        type: 'admin_connect',
                        adminId: adminId
                    }));
                    
                    updateStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ ‚úÖ', 'success');
                    updateAdminId();
                    console.log('‚úÖ –ê–¥–º–∏–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω:', adminId);
                };
                
                socket.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        
                        switch (data.type) {
                            case 'all_tests':
                                processAllTests(data.tests);
                                break;
                                
                            case 'new_test':
                                processNewTest(data);
                                break;
                                
                            case 'answer_update':
                                processAnswerUpdate(data);
                                break;
                        }
                    } catch (err) {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', err);
                    }
                };
                
                socket.onerror = (error) => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ WebSocket:', error);
                    updateStatus('–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚ùå', 'error');
                };
                
                socket.onclose = () => {
                    isConnected = false;
                    updateStatus('–ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'warning');
                    console.log('üîå WebSocket –æ—Ç–∫–ª—é—á–µ–Ω, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...');
                    
                    setTimeout(connectWebSocket, 3000);
                };
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
            function processAllTests(allTests) {
                rooms.clear();
                
                allTests.forEach(test => {
                    addOrUpdateTest(test);
                });
                
                renderRooms();
                updateRoomsCount();
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
            function processNewTest(testData) {
                addOrUpdateTest(testData);
                renderRooms();
                updateRoomsCount();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                showNotification(`–ù–æ–≤—ã–π —Ç–µ—Å—Ç –≤ –∫–æ–º–Ω–∞—Ç–µ ${getRoomName(testData.helperId)}`);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞
            function processAnswerUpdate(data) {
                const testId = data.testId;
                
                // –ù–∞—Ö–æ–¥–∏–º —Ç–µ—Å—Ç –≤–æ –≤—Å–µ—Ö –∫–æ–º–Ω–∞—Ç–∞—Ö
                for (const [roomId, room] of rooms.entries()) {
                    const test = room.tests.find(t => t.testId === testId);
                    if (test) {
                        if (!test.answers) test.answers = new Map();
                        test.answers.set(data.questionId, data.answer);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–æ–º–Ω–∞—Ç—É
                        updateRoomCard(roomId);
                        break;
                    }
                }
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
            function addOrUpdateTest(testData) {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä –∫–æ–º–Ω–∞—Ç—ã –∏–∑ helperId
                // –§–æ—Ä–º–∞—Ç: helper-roomX-XXXX –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ helper-XXXX
                const roomMatch = testData.helperId.match(/room(\d+)/i);
                const roomId = roomMatch ? roomMatch[1] : 'default';
                
                if (!rooms.has(roomId)) {
                    rooms.set(roomId, {
                        roomId: roomId,
                        roomName: `–ö–æ–º–Ω–∞—Ç–∞ ${roomId}`,
                        tests: [],
                        lastActivity: Date.now()
                    });
                }
                
                const room = rooms.get(roomId);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —ç—Ç–æ—Ç —Ç–µ—Å—Ç
                const existingTestIndex = room.tests.findIndex(t => t.testId === testData.testId);
                
                if (existingTestIndex !== -1) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ç–µ—Å—Ç
                    room.tests[existingTestIndex] = {
                        ...room.tests[existingTestIndex],
                        ...testData,
                        answers: room.tests[existingTestIndex].answers || new Map()
                    };
                } else {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–µ—Å—Ç
                    room.tests.push({
                        ...testData,
                        answers: new Map()
                    });
                }
                
                room.lastActivity = Date.now();
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∫–æ–º–Ω–∞—Ç—ã
            function getRoomName(helperId) {
                const roomMatch = helperId.match(/room(\d+)/i);
                return roomMatch ? `–ö–æ–º–Ω–∞—Ç–∞ ${roomMatch[1]}` : '–ë–µ–∑ –∫–æ–º–Ω–∞—Ç—ã';
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–∞
            function submitAnswer(testId, questionId, answer) {
                if (!socket || !isConnected) {
                    showNotification('–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    return;
                }
                
                socket.send(JSON.stringify({
                    type: 'submit_answer',
                    adminId: adminId,
                    testId: testId,
                    questionId: questionId,
                    answer: answer
                }));
                
                console.log(`üì§ –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: ${questionId} -> "${answer}"`);
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–æ–º–Ω–∞—Ç
            function renderRooms() {
                const container = document.getElementById('rooms-container');
                const emptyState = document.getElementById('empty-state');
                
                if (rooms.size === 0) {
                    emptyState.style.display = 'block';
                    container.innerHTML = '<div class="empty-state" id="empty-state"><div>üì≠</div><div>–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç –ø–æ–∫–∞ –Ω–µ—Ç</div><div style="font-size: 14px; margin-top: 10px;">–û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div></div>';
                    return;
                }
                
                emptyState.style.display = 'none';
                
                let html = '';
                
                // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–Ω–∞—Ç—ã –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                const sortedRooms = Array.from(rooms.entries())
                    .sort((a, b) => b[1].lastActivity - a[1].lastActivity);
                
                sortedRooms.forEach(([roomId, room]) => {
                    const totalQuestions = room.tests.reduce((sum, test) => sum + (test.questions?.length || 0), 0);
                    const answeredQuestions = room.tests.reduce((sum, test) => {
                        if (!test.answers) return sum;
                        return sum + Array.from(test.answers.values()).filter(a => a && a.trim() !== '').length;
                    }, 0);
                    
                    const progress = totalQuestions > 0 ? Math.round((answeredQuestions / totalQuestions) * 100) : 0;
                    
                    html += `
                        <div class="room-card ${room.tests.length > 0 ? 'active' : ''}" id="room-${roomId}">
                            <div class="room-header">
                                <div class="room-number">${room.roomName}</div>
                                <div class="room-stats">
                                    <span>üìù ${room.tests.length} —Ç–µ—Å—Ç(–æ–≤)</span>
                                    <span>‚úÖ ${progress}%</span>
                                </div>
                            </div>
                            
                            <div class="questions-list" id="questions-${roomId}">
                                ${renderRoomQuestions(room)}
                            </div>
                            
                            <div class="room-actions">
                                <button class="btn btn-secondary" onclick="refreshRoom('${roomId}')">
                                    üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                                </button>
                                <button class="btn btn-primary" onclick="markAllAnswered('${roomId}')">
                                    ‚úÖ –í—Å–µ –æ—Ç–≤–µ—Ç—ã
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫–æ–º–Ω–∞—Ç—ã
            function renderRoomQuestions(room) {
                if (!room.tests || room.tests.length === 0) {
                    return '<div style="color: #888; text-align: center; padding: 20px;">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</div>';
                }
                
                let html = '';
                
                room.tests.forEach(test => {
                    if (!test.questions) return;
                    
                    test.questions.forEach((question, index) => {
                        const answer = test.answers?.get(question.id) || '';
                        
                        html += `
                            <div class="question-item">
                                <div class="question-header">
                                    <div class="question-number">${test.testId.slice(-6)}-–í${index + 1}</div>
                                    <div style="font-size: 11px; color: ${answer ? '#4CAF50' : '#f44336'}">
                                        ${answer ? '‚úì –û—Ç–≤–µ—Ç –¥–∞–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç'}
                                    </div>
                                </div>
                                <div style="font-size: 13px; margin-bottom: 8px; color: #ccc;">
                                    ${question.text ? question.text.substring(0, 100) + (question.text.length > 100 ? '...' : '') : '–ë–µ–∑ —Ç–µ–∫—Å—Ç–∞'}
                                </div>
                                <input type="text" 
                                       class="answer-input" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç..."
                                       value="${answer}"
                                       onchange="window.submitAnswerHelper('${test.testId}', '${question.id}', this.value)"
                                       data-testid="${test.testId}"
                                       data-questionid="${question.id}">
                            </div>
                        `;
                    });
                });
                
                return html;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–º–Ω–∞—Ç—ã
            function updateRoomCard(roomId) {
                const room = rooms.get(roomId);
                if (!room) return;
                
                const questionsContainer = document.getElementById(`questions-${roomId}`);
                if (questionsContainer) {
                    questionsContainer.innerHTML = renderRoomQuestions(room);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                const roomCard = document.getElementById(`room-${roomId}`);
                if (roomCard) {
                    const totalQuestions = room.tests.reduce((sum, test) => sum + (test.questions?.length || 0), 0);
                    const answeredQuestions = room.tests.reduce((sum, test) => {
                        if (!test.answers) return sum;
                        return sum + Array.from(test.answers.values()).filter(a => a && a.trim() !== '').length;
                    }, 0);
                    const progress = totalQuestions > 0 ? Math.round((answeredQuestions / totalQuestions) * 100) : 0;
                    
                    const statsSpan = roomCard.querySelector('.room-stats span:last-child');
                    if (statsSpan) {
                        statsSpan.textContent = `‚úÖ ${progress}%`;
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            function updateStatus(text, type = 'info') {
                const statusElement = document.getElementById('connection-status');
                if (statusElement) {
                    statusElement.textContent = text;
                    
                    const dot = statusElement.previousElementSibling;
                    if (dot) {
                        dot.style.background = type === 'success' ? '#4CAF50' : 
                                              type === 'warning' ? '#FF9800' : 
                                              type === 'error' ? '#f44336' : '#2196F3';
                    }
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ID –∞–¥–º–∏–Ω–∞
            function updateAdminId() {
                const adminIdElement = document.getElementById('admin-id');
                if (adminIdElement && adminId) {
                    adminIdElement.textContent = adminId.substring(0, 8) + '...';
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ–º–Ω–∞—Ç
            function updateRoomsCount() {
                const countElement = document.getElementById('rooms-count');
                if (countElement) {
                    countElement.textContent = rooms.size;
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            function showNotification(message, type = 'info') {
                // –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 20px;
                    background: ${type === 'success' ? '#4CAF50' : 
                                type === 'error' ? '#f44336' : '#2196F3'};
                    color: white;
                    border-radius: 8px;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                    animation: slideIn 0.3s ease;
                    max-width: 300px;
                    font-family: 'Segoe UI', sans-serif;
                `;
                
                notification.textContent = message;
                document.body.appendChild(notification);
                
                // –£–¥–∞–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
                
                // –î–æ–±–∞–≤–ª—è–µ–º CSS –∞–Ω–∏–º–∞—Ü–∏–∏
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
            }
            
            // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
            window.refreshRoom = function(roomId) {
                if (socket && isConnected) {
                    socket.send(JSON.stringify({
                        type: 'request_all_tests',
                        adminId: adminId
                    }));
                    showNotification(`–ö–æ–º–Ω–∞—Ç–∞ ${roomId} –æ–±–Ω–æ–≤–ª–µ–Ω–∞`, 'success');
                }
            };
            
            window.markAllAnswered = function(roomId) {
                const room = rooms.get(roomId);
                if (!room) return;
                
                room.tests.forEach(test => {
                    if (test.questions) {
                        test.questions.forEach(question => {
                            const currentAnswer = test.answers?.get(question.id);
                            if (!currentAnswer || currentAnswer.trim() === '') {
                                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è–µ–º "–æ—Ç–≤–µ—Ç –¥–∞–Ω"
                                submitAnswer(test.testId, question.id, "–æ—Ç–≤–µ—Ç –¥–∞–Ω");
                            }
                        });
                    }
                });
                
                showNotification(`–í—Å–µ –æ—Ç–≤–µ—Ç—ã –≤ –∫–æ–º–Ω–∞—Ç–µ ${roomId} –æ—Ç–º–µ—á–µ–Ω—ã`, 'success');
            };
            
            window.submitAnswerHelper = function(testId, questionId, answer) {
                submitAnswer(testId, questionId, answer);
            };
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            function init() {
                console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...');
                
                // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket
                connectWebSocket();
                
                // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                setInterval(() => {
                    if (!isConnected && socket?.readyState !== WebSocket.CONNECTING) {
                        connectWebSocket();
                    }
                }, 10000);
                
                // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–µ—Å—Ç—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
                setInterval(() => {
                    if (socket && isConnected) {
                        socket.send(JSON.stringify({
                            type: 'request_all_tests',
                            adminId: adminId
                        }));
                    }
                }, 30000);
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                setInterval(() => {
                    updateRoomsCount();
                }, 5000);
            }
            
            // –ó–∞–ø—É—Å–∫
            init();
        })();
    </script>
</body>
</html>
